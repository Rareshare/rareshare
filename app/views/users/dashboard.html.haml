%ul.nav.nav-tabs
  %li.active= link_to "My Leases", "#leases", data: { toggle: "tab" }
  %li= link_to "My Tools", "#tools", data: { toggle: "tab" }
  %li
    = link_to "#inbox", data: { toggle: "tab" } do
      Inbox
      %span.badge.badge-info= current_user.unread_message_count

%div.tab-content
  %div.tab-pane.active#leases
    %h4 Lease a tool
    = render partial: "shared/search"
    %h4 Current Leases
    %table.table
      %thead
        %tr
          %th State
          %th Dates
          %th Item description
          %th Cost
          %th Options
      %tbody
        - current_user.leases.active.each do |l|
          %tr
            %td
              %span.label{class: "label-#{label_class_for(l)}"}= l.state
            %td= l.duration_text
            %td= l.tool.display_name
            %td= number_to_currency l.total_cost
            %td= simple_form_for(l, method: :delete) { |f| f.submit "Cancel", class: "btn btn-danger" } unless l.cancelled?
  %div.tab-pane#tools
    %h4 Share a tool
    = link_to "Share a tool now", new_tool_path, class: "btn btn-primary"
    %h4 Leaseable tools
    %table.table
      %thead
        %tr
          %th Item description
          %th Cost
          %th Options
      %tbody
        - current_user.tools.each do |t|
          %tr
            %td= link_to t.display_name, tool_path(t)
            %td
              = number_to_currency t.price_per_hour_adjusted
              %span.muted per hour
            %td= simple_form_for(t, method: :delete) { |f| f.submit "Delete", class: "btn btn-danger" }
  %div.tab-pane#inbox
    %h4 Inbox
    %table.table
      %thead
        %tr
          %th Time
          %th From
          %th Body
      %tbody
        - current_user.received_messages.each do |m|
          %tr
            %td= m.created_at < 1.week.ago ? m.created_at.to_s(:long) : time_ago_in_words(m.created_at) + " ago"
            %td= m.sender.email
            %td
              = link_to message_path(m) do
                - if m.acknowledged?
                  = truncate(m.body, length: 80)
                - else
                  %strong= truncate(m.body, length: 80)